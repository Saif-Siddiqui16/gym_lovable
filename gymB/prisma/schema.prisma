generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id         Int              @id @default(autoincrement())
  name       String
  branchName String?
  owner      String?
  phone      String?
  location   String?
  status     String           @default("Active")
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
  Attendance Attendance[]
  classes    Class[]
  equipment  Equipment[]
  expenses   Expense[]
  inventory  Inventory[]
  invoices   Invoice[]
  leads      Lead[]
  lockers    Locker[]
  members    Member[]
  plans      MembershipPlan[]
  payroll    Payroll[]
  users      User[]
  coupons    Coupon[]
  storeCategories StoreCategory[]
  storeProducts   StoreProduct[]
  storeOrders     StoreOrder[]

  @@map("tenant")
}

model User {
  id             Int          @id @default(autoincrement())
  email          String       @unique
  password       String
  name           String
  phone          String?
  role           Role
  status         String       @default("Active")
  avatar         String?
  tenantId       Int?
  joinedDate     DateTime     @default(now())
  lastLogin      DateTime?
  address        String?      @db.Text
  accountNumber  String?
  baseSalary     Decimal?     @db.Decimal(10, 2)
  config         String?      @db.LongText
  department     String?
  documents      String?      @db.LongText
  ifsc           String?
  attendances    Attendance[]
  classes        Class[]
  assignedLeads  Lead[]       @relation("LeadAssignee")
  assignedMember Member[]     @relation("TrainerToMember")
  tenant         Tenant?      @relation(fields: [tenantId], references: [id])

  @@index([tenantId], map: "user_tenantId_fkey")
  @@map("user")
}

model SaaSPlan {
  id          Int      @id @default(autoincrement())
  name        String
  price       Decimal  @db.Decimal(10, 2)
  period      String
  features    String?  @db.LongText
  status      String   @default("Active")
  benefits    String?  @db.LongText
  createdAt   DateTime @default(now())
  description String?  @db.Text
  limits      String?  @db.LongText
  opsLimits   String?  @db.LongText
  updatedAt   DateTime @updatedAt

  @@map("saasplan")
}

model Subscription {
  id            String   @id @default(uuid())
  tenantId      Int
  planId        Int
  subscriber    String
  startDate     DateTime
  endDate       DateTime
  status        String
  paymentStatus String

  @@map("subscription")
}

model AuditLog {
  id             Int      @id @default(autoincrement())
  userId         Int
  action         String
  affectedEntity String?
  details        String?  @db.Text
  module         String
  ip             String?
  createdAt      DateTime @default(now())

  @@map("auditlog")
}

model WebhookLog {
  id         String   @id @default(uuid())
  event      String
  status     String
  method     String
  endpoint   String
  statusCode Int
  payload    String?  @db.LongText
  createdAt  DateTime @default(now())

  @@map("webhooklog")
}

model SaaSSettings {
  id                 Int     @id @default(autoincrement())
  siteName           String  @default("Gym CRM")
  currency           String  @default("INR")
  timezone           String  @default("IST")
  invoicePrefix      String  @default("INV-")
  invoiceStartNumber Int     @default(1001)
  gstPercent         Decimal @default(18.00) @db.Decimal(5, 2)
  bookingEnabled     Boolean @default(true)
  creditsPerBooking  Int     @default(1)
  maxBookingsPerDay  Int     @default(2)
  maxBookingsPerWeek Int     @default(10)
  cancellationWindow Int     @default(4)
  advanceBookingDays Int     @default(7)
  penaltyEnabled     Boolean @default(true)
  penaltyCredits     Int     @default(1)
  contactAddress     String? @db.Text
  contactPhone       String?
  supportEmail       String?

  @@map("saassettings")
}

model SaasPayment {
  id         String   @id @default(uuid())
  paymentId  String   @unique
  tenantId   Int
  tenantName String
  amount     Decimal  @db.Decimal(10, 2)
  method     String
  status     String   @default("Success")
  date       DateTime @default(now())

  @@map("saaspayment")
}

model Device {
  id           Int      @id @default(autoincrement())
  name         String
  type         String
  status       String   @default("connected")
  message      String?
  tenantId     Int?
  lastSeen     DateTime @default(now())
  entriesToday Int      @default(0)
  ipAddress    String?

  @@map("device")
}

model Member {
  id             Int             @id @default(autoincrement())
  memberId       String          @unique
  userId         Int?            @unique
  tenantId       Int
  planId         Int?
  joinDate       DateTime        @default(now())
  expiryDate     DateTime?
  status         String          @default("Active")
  trainerId      Int?
  avatar         String?
  benefits       String?         @db.LongText
  email          String?
  emergencyName  String?
  emergencyPhone String?
  fitnessGoal    String?
  gender         String?
  medicalHistory String?         @db.Text
  name           String?
  phone          String?
  targetWeight   Decimal?        @db.Decimal(5, 2)
  targetBodyFat  Decimal?        @db.Decimal(5, 2)
  bookings       Booking[]
  storeOrders    StoreOrder[]
  invoices       Invoice[]
  plan           MembershipPlan? @relation(fields: [planId], references: [id])
  tenant         Tenant          @relation(fields: [tenantId], references: [id])
  trainer        User?           @relation("TrainerToMember", fields: [trainerId], references: [id])

  @@index([planId], map: "member_planId_fkey")
  @@index([tenantId], map: "member_tenantId_fkey")
  @@index([trainerId], map: "member_trainerId_fkey")
  @@map("member")
}

model MembershipPlan {
  id                 Int      @id @default(autoincrement())
  tenantId           Int
  name               String
  price              Decimal  @db.Decimal(10, 2)
  duration           Int
  status             String   @default("Active")
  benefits           String?  @db.LongText
  cancellationWindow Int      @default(4)
  createdAt          DateTime @default(now())
  creditsPerBooking  Int      @default(1)
  description        String?  @db.Text
  durationType       String   @default("Months")
  maxBookingsPerDay  Int      @default(1)
  maxBookingsPerWeek Int      @default(7)
  updatedAt          DateTime @updatedAt
  members            Member[]
  tenant             Tenant   @relation(fields: [tenantId], references: [id])

  @@index([tenantId], map: "membershipplan_tenantId_fkey")
  @@map("membershipplan")
}

model Lead {
  id               Int        @id @default(autoincrement())
  tenantId         Int
  name             String
  email            String?
  phone            String
  source           String?
  status           String     @default("New")
  createdAt        DateTime   @default(now())
  age              Int?
  assignedToId     Int?
  budget           String?
  gender           String?
  interests        String?    @db.LongText
  nextFollowUp     DateTime?
  notes            String?    @db.Text
  preferredContact String?    @default("WhatsApp")
  updatedAt        DateTime   @updatedAt
  followUps        FollowUp[]
  assignedTo       User?      @relation("LeadAssignee", fields: [assignedToId], references: [id])
  tenant           Tenant     @relation(fields: [tenantId], references: [id])

  @@index([assignedToId], map: "lead_assignedToId_fkey")
  @@index([tenantId], map: "lead_tenantId_fkey")
  @@map("lead")
}

model FollowUp {
  id        Int       @id @default(autoincrement())
  leadId    Int
  notes     String?
  status    String
  nextDate  DateTime?
  createdAt DateTime  @default(now())
  lead      Lead      @relation(fields: [leadId], references: [id])

  @@index([leadId], map: "followup_leadId_fkey")
  @@map("followup")
}

model Class {
  id              Int       @id @default(autoincrement())
  tenantId        Int
  name            String
  description     String?   @db.Text
  trainerId       Int?
  schedule        String    @db.LongText
  maxCapacity     Int
  duration        String?
  location        String?
  requiredBenefit String?
  status          String    @default("Scheduled")
  bookings        Booking[]
  tenant          Tenant    @relation(fields: [tenantId], references: [id])
  trainer         User?     @relation(fields: [trainerId], references: [id])

  @@index([tenantId], map: "class_tenantId_fkey")
  @@index([trainerId], map: "class_trainerId_fkey")
  @@map("class")
}

model Booking {
  id       Int      @id @default(autoincrement())
  memberId Int
  classId  Int
  date     DateTime
  status   String   @default("Upcoming")
  class    Class    @relation(fields: [classId], references: [id])
  member   Member   @relation(fields: [memberId], references: [id])

  @@index([classId], map: "booking_classId_fkey")
  @@index([memberId], map: "booking_memberId_fkey")
  @@map("booking")
}

model Inventory {
  id           Int     @id @default(autoincrement())
  tenantId     Int?
  itemName     String
  category     String
  quantity     Int
  unit         String
  minThreshold Int     @default(5)
  status       String  @default("In Stock")
  tenant       Tenant? @relation(fields: [tenantId], references: [id])

  @@index([tenantId], map: "inventory_tenantId_fkey")
  @@map("inventory")
}

model Locker {
  id           Int     @id @default(autoincrement())
  tenantId     Int?
  number       String
  status       String  @default("Available")
  assignedToId Int?
  tenant       Tenant? @relation(fields: [tenantId], references: [id])

  @@index([tenantId], map: "locker_tenantId_fkey")
  @@map("locker")
}

model Equipment {
  id             Int                  @id @default(autoincrement())
  tenantId       Int?
  name           String
  status         String               @default("Operational")
  lastService    DateTime?
  nextService    DateTime?
  brand          String?
  category       String?
  location       String?
  model          String?
  purchaseDate   DateTime?
  serialNumber   String?
  warrantyExpiry DateTime?
  tenant         Tenant?              @relation(fields: [tenantId], references: [id])
  maintenance    MaintenanceRequest[]

  @@index([tenantId], map: "equipment_tenantId_fkey")
  @@map("equipment")
}

model MaintenanceRequest {
  id          Int       @id @default(autoincrement())
  equipmentId Int
  issue       String
  priority    String
  status      String    @default("Pending")
  createdAt   DateTime  @default(now())
  equipment   Equipment @relation(fields: [equipmentId], references: [id])

  @@index([equipmentId], map: "maintenancerequest_equipmentId_fkey")
  @@map("maintenancerequest")
}

model Invoice {
  id            Int           @id @default(autoincrement())
  tenantId      Int
  invoiceNumber String        @unique
  memberId      Int?
  subtotal      Decimal       @db.Decimal(10, 2) @default(0.00)
  taxRate       Decimal       @db.Decimal(10, 2) @default(0.00)
  taxAmount     Decimal       @db.Decimal(10, 2) @default(0.00)
  discount      Decimal       @db.Decimal(10, 2) @default(0.00)
  amount        Decimal       @db.Decimal(10, 2)
  status        String        @default("Unpaid")
  dueDate       DateTime
  paidDate      DateTime?
  paymentMode   String        @default("Cash")
  notes         String?       @db.Text
  items         InvoiceItem[]
  member        Member?       @relation(fields: [memberId], references: [id])
  tenant        Tenant        @relation(fields: [tenantId], references: [id])

  @@index([tenantId], map: "invoice_tenantId_fkey")
  @@map("invoice")
}

model InvoiceItem {
  id          Int     @id @default(autoincrement())
  invoiceId   Int
  description String
  quantity    Int
  rate        Decimal @db.Decimal(10, 2)
  amount      Decimal @db.Decimal(10, 2)
  invoice     Invoice @relation(fields: [invoiceId], references: [id])

  @@index([invoiceId], map: "invoiceitem_invoiceId_fkey")
  @@map("invoice_item")
}

model Expense {
  id       Int      @id @default(autoincrement())
  tenantId Int
  title    String
  category String
  amount   Decimal  @db.Decimal(10, 2)
  date     DateTime
  status   String   @default("Paid")
  addedBy  String?
  notes    String?  @db.Text
  tenant   Tenant   @relation(fields: [tenantId], references: [id])

  @@index([tenantId], map: "expense_tenantId_fkey")
  @@map("expense")
}

model Payroll {
  id       Int     @id @default(autoincrement())
  tenantId Int
  staffId  Int
  amount   Decimal @db.Decimal(10, 2)
  month    Int
  year     Int
  status   String  @default("Pending")
  tenant   Tenant  @relation(fields: [tenantId], references: [id])

  @@index([tenantId], map: "payroll_tenantId_fkey")
  @@map("payroll")
}

model Attendance {
  id       Int       @id @default(autoincrement())
  userId   Int
  checkIn  DateTime?
  checkOut DateTime?
  type     String
  date     DateTime  @default(now()) @db.Date
  status   String    @default("Present")
  tenantId Int       @default(1)
  tenant   Tenant    @relation(fields: [tenantId], references: [id])
  user     User      @relation(fields: [userId], references: [id])

  @@index([tenantId], map: "attendance_tenantId_fkey")
  @@index([userId], map: "attendance_userId_fkey")
  @@map("attendance")
}

model LeaveRequest {
  id        Int      @id @default(autoincrement())
  tenantId  Int      @default(1)
  userId    Int
  type      String   @default("Vacation")
  startDate DateTime
  endDate   DateTime
  reason    String   @db.Text
  status    String   @default("Pending")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId], map: "leave_request_tenantId_fkey")
  @@index([userId], map: "leave_request_userId_fkey")
  @@map("leave_request")
}

model TrainerAvailability {
  id             Int      @id @default(autoincrement())
  tenantId       Int      @default(1)
  trainerId      Int      @unique
  weeklySchedule String   @db.LongText
  preferences    String   @db.LongText
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("trainer_availability")
}

model Task {
  id           Int      @id @default(autoincrement())
  title        String
  assignedToId Int
  creatorId    Int
  priority     String
  dueDate      DateTime
  status       String   @default("Pending")

  @@index([assignedToId], map: "Task_assignedToId_fkey")
  @@index([creatorId], map: "Task_creatorId_fkey")
  @@map("task")
}

model Wallet {
  id       Int     @id @default(autoincrement())
  memberId Int     @unique
  balance  Decimal @default(0.00) @db.Decimal(10, 2)

  @@map("wallet")
}

model Transaction {
  id          Int      @id @default(autoincrement())
  walletId    Int
  amount      Decimal  @db.Decimal(10, 2)
  type        String
  description String?
  createdAt   DateTime @default(now())

  @@index([walletId], map: "Transaction_walletId_fkey")
  @@map("transaction")
}

model MemberProgress {
  id           Int      @id @default(autoincrement())
  memberId     Int
  weight       Decimal? @db.Decimal(5, 2)
  bodyFat      Decimal? @db.Decimal(5, 2)
  notes        String?
  date         DateTime @default(now())
  measurements String?  @db.LongText
  photos       String?  @db.LongText

  @@index([memberId], map: "MemberProgress_memberId_fkey")
  @@map("memberprogress")
}

model Announcement {
  id         Int      @id @default(autoincrement())
  title      String
  content    String   @db.Text
  authorId   Int
  createdAt  DateTime @default(now())
  priority   String   @default("medium")
  targetRole String   @default("all")
  tenantId   Int?

  @@index([authorId], map: "Announcement_authorId_fkey")
  @@map("announcement")
}

model TenantSettings {
  id              Int     @id @default(autoincrement())
  tenantId        Int     @unique
  logo            String?
  timezone        String  @default("UTC")
  currency        String  @default("USD")
  whatsappEnabled Boolean @default(false)

  @@map("tenantsettings")
}

model Reward {
  id          Int      @id @default(autoincrement())
  tenantId    Int?
  memberId    Int?
  name        String   @default("Reward")
  points      Int      @default(0)
  description String   @default("")
  date        DateTime @default(now())

  @@map("reward")
}

model Feedback {
  id       Int      @id @default(autoincrement())
  tenantId Int?
  memberId Int?
  rating   Int
  comment  String   @db.Text
  status   String   @default("Pending")
  date     DateTime @default(now())

  @@map("feedback")
}

model DietPlan {
  id        String   @id @default(uuid())
  tenantId  Int      @default(1)
  trainerId Int
  clientId  Int
  name      String
  target    String
  duration  String
  calories  Int
  macros    String   @db.LongText
  meals     String   @db.LongText
  notes     String?  @db.Text
  status    String   @default("Active")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("diet_plan")
}

model WorkoutPlan {
  id             String   @id @default(uuid())
  tenantId       Int      @default(1)
  trainerId      Int
  clientId       Int
  name           String
  level          String   @default("Beginner")
  duration       String
  goal           String
  volume         String
  timePerSession String
  intensity      String
  status         String   @default("Active")
  days           String   @db.LongText
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("workout_plan")
}

model Coupon {
  id           Int      @id @default(autoincrement())
  tenantId     Int?
  code         String   @unique
  description  String?  @db.Text
  type         String   @default("Percentage") // Percentage or Fixed
  value        Decimal  @db.Decimal(10, 2)
  minPurchase  Decimal? @db.Decimal(10, 2) @default(0.00)
  maxUses      Int?     @default(0) // 0 for unlimited
  usedCount    Int      @default(0)
  startDate    DateTime @default(now())
  endDate      DateTime?
  status       String   @default("Active")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  tenant       Tenant?  @relation(fields: [tenantId], references: [id])

  @@index([tenantId], map: "coupon_tenantId_fkey")
  @@map("coupon")
}

model StoreCategory {
  id          Int      @id @default(autoincrement())
  tenantId    Int?
  name        String
  description String?  @db.Text
  image       String?
  sortOrder   Int      @default(0)
  status      String   @default("Active")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  products    StoreProduct[]
  tenant      Tenant?  @relation(fields: [tenantId], references: [id])

  @@index([tenantId], map: "storecategory_tenantId_fkey")
  @@map("store_category")
}

model StoreProduct {
  id            Int         @id @default(autoincrement())
  tenantId      Int?
  categoryId    Int?
  name          String
  sku           String?     @unique
  category      String?     
  price         Decimal     @db.Decimal(10, 2)
  originalPrice Decimal?    @db.Decimal(10, 2)
  costPrice     Decimal?    @db.Decimal(10, 2)
  taxRate       Decimal?    @db.Decimal(5, 2) @default(0.00)
  stock         Int         @default(0)
  status        String      @default("Active")
  description   String?     @db.Text
  image         String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  categoryRel   StoreCategory? @relation(fields: [categoryId], references: [id])
  tenant        Tenant?     @relation(fields: [tenantId], references: [id])
  orderItems    StoreOrderItem[]

  @@index([tenantId], map: "storeproduct_tenantId_fkey")
  @@index([categoryId], map: "storeproduct_categoryId_fkey")
  @@map("store_product")
}

model StoreOrder {
  id          Int              @id @default(autoincrement())
  tenantId    Int?
  memberId    Int?
  total       Decimal          @db.Decimal(10, 2)
  itemsCount  Int              @default(0)
  status      String           @default("Processing")
  date        DateTime         @default(now())
  guestName   String?
  guestPhone  String?
  guestEmail  String?
  items       StoreOrderItem[]
  member      Member?          @relation(fields: [memberId], references: [id])
  tenant      Tenant?          @relation(fields: [tenantId], references: [id])

  @@index([tenantId], map: "storeorder_tenantId_fkey")
  @@index([memberId], map: "storeorder_memberId_fkey")
  @@map("store_order")
}

model StoreOrderItem {
  id         Int          @id @default(autoincrement())
  orderId    Int
  productId  Int
  quantity   Int
  priceAtBuy Decimal      @db.Decimal(10, 2)
  order      StoreOrder   @relation(fields: [orderId], references: [id])
  product    StoreProduct @relation(fields: [productId], references: [id])

  @@index([orderId], map: "storeorderitem_orderId_fkey")
  @@index([productId], map: "storeorderitem_productId_fkey")
  @@map("store_order_item")
}

enum Role {
  SUPER_ADMIN
  BRANCH_ADMIN
  MANAGER
  STAFF
  TRAINER
  MEMBER
}
